function cities(t){let a=$("[data-toggle=cities]");if(0==a.length)return!1;$.get(a.data("url")+"?country="+t,function(t){a.html(t)}).fail(function(){$.notify({message:lang.nodata},{type:"danger",placement:{from:"bottom",align:"right"}})})}function piechart(t,a){$.get(a,function(a){let e=[],i=[];for(var o in a.chart)e.push(o),i.push(a.chart[o]);if(window.datachart=new Chart(t,{type:"pie",data:{labels:e,datasets:[{data:i,borderWidth:5,backgroundColor:["#BAE1FF","#FFDFBA","#FFFFBA","#BAFFC9","#FFB3BA","#FFBAF1","#FFABAB","#FFC3A0","#FF677D","#D4A5A5","#392F5A","#B9FBC0","#A0E7E5","#F9FBCB","#F6B93B"]}]},options:{responsive:!window.MSInputMethodContext,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",display:!0}},cutoutPercentage:75}}),a.top){$("#top-"+t.data("type")).html("");let e=0;for(const[t,i]of Object.entries(a.top))e+=i;for(const[i,o]of Object.entries(a.top))if("languages"==t.data("type")){let a=(o/e*100).toFixed(2);$("#top-"+t.data("type")).append('<li class="position-relative d-block mb-2 w-100 border-bottom pb-2 fw-bold"><div class="bg-primary position-absolute d-block h-100 rounded" style="z-index:0;opacity:0.1;width:'+a+'%;min-height:30px;"></div><div class="position-relative px-1 pt-1"><span class="align-middle">'+i+'</span> <span class="float-end float-right"><span class="fw-bold">'+o+" ("+a+"%)</span></span></div></li>")}else{let a=appurl+"static/images/"+t.data("type")+"/"+i.split(" ")[0].toLowerCase()+".svg";"Unknown"==i.split(" ")[0]&&(a=appurl+"static/images/unknown.svg");let n=(o/e*100).toFixed(2);$("#top-"+t.data("type")).append('<li class="position-relative d-block mb-2 w-100 border-bottom pb-2 fw-bold"><div class="bg-primary position-absolute d-block h-100 rounded" style="z-index:0;opacity:0.1;width:'+n+'%;min-height:30px;"></div><div class="position-relative px-1 pt-1"><img src="'+a+'" width="16" class="mr-1 me-1"><span class="align-middle">'+i+'</span> <span class="float-end float-right"><span class="fw-bold">'+o+" ("+n+"%)</span></span></div></li>")}}}).fail(function(){$.notify({message:lang.nodata},{type:"danger",placement:{from:"bottom",align:"right"}})})}function charts(t,a){$.get(a,function(a){let e=[],i=[],o=t.get()[0].getContext("2d").createLinearGradient(0,0,0,225);for(var n in o.addColorStop(0,t.data("color-start")?t.data("color-start"):"rgba(0, 138, 255, 1)"),a.data)e.push(n),i.push(a.data[n]);if(a.count)for(var s in a.count)console.log(s),$("[data-count="+s+"]").length>0&&$("[data-count="+s+"]").text(a.count[s]);window.clickchart=new Chart(t,{type:"bar",data:{labels:e,datasets:[{label:a.label,fill:!0,tension:.3,backgroundColor:o,borderColor:t.data("color-border")?t.data("color-border"):"#008aff",borderWidth:2,borderRadius:5,borderSkipped:"bottom",data:i}]},options:{maintainAspectRatio:!1,legend:{display:!1},tooltips:{intersect:!1},hover:{intersect:!0},plugins:{filler:{propagate:!1},legend:{display:!1}},scales:{x:{grid:{display:!1},min:0},y:{grid:{display:!1},min:0}}}})}).fail(function(){$.notify({message:lang.nodata},{type:"danger",placement:{from:"bottom",align:"right"}})})}function maps(t,a){$.get(a,function(a){window.map=new jsVectorMap({map:"world",selector:"#"+t.attr("id"),zoomButtons:!0,visualizeData:{scale:["#a6d1f5","#008aff"],values:a.list},regionsSelectable:!0,regionsSelectableOne:!0,zoomOnScroll:!0,onRegionTooltipShow(t,e){t.text(t.text()+" ("+(void 0!==a.list[e]?a.list[e]:0)+")")},onRegionSelected(t){cities(t)}}),$("#top-countries").html("");let e=0;for(const[t,i]of Object.entries(a.top))e+=i.count;for(const[t,i]of Object.entries(a.top)){let a=appurl+"static/images/flags/"+t.toLowerCase()+".svg";"Unknown"==i.name&&(a=appurl+"static/images/unknown.svg");let o=(i.count/e*100).toFixed(2);$("#top-countries").append('<li class="position-relative d-block mb-2 w-100 border-bottom pb-2 fw-bold"><div class="bg-primary position-absolute d-block position-absolute h-100 rounded" style="z-index:0;opacity:0.1;width:'+o+'%;min-height:30px;"></div><div class="position-relative px-1 pt-1"><img src="'+a+'" width="16" class="mr-1 me-1"><span class="align-middle">'+i.name+'</span> <span class="float-end float-right"><span class="fw-bold">'+i.count+" ("+o+"%)</span></span></div></li>")}if(void 0!==typeof a.cities&&a.cities){$("#top-cities").html("");let t=0;for(const[e,i]of Object.entries(a.cities))t+=i.count;for(const[e,i]of Object.entries(a.cities)){let a=appurl+"static/images/flags/"+i.country.toLowerCase()+".svg";"Unknown"==i.name&&(a=appurl+"static/images/unknown.svg");let e=(i.count/t*100).toFixed(2);$("#top-cities").append('<li class="position-relative d-block mb-2 w-100 border-bottom pb-2 fw-bold"><div class="bg-primary position-absolute d-block position-absolute h-100 rounded" style="z-index:0;opacity:0.1;width:'+e+'%;min-height:30px;"></div><div class="position-relative px-1 pt-1"><img src="'+a+'" width="16" class="mr-1 me-1"><span class="align-middle">'+i.name+'</span> <span class="float-end float-right"><span class="fw-bold">'+i.count+" ("+e+"%)</span></span></div></li>")}}window.addEventListener("resize",()=>{window.map.updateSize()})}).fail(function(){$.notify({message:lang.nodata},{type:"danger",placement:{from:"bottom",align:"right"}})})}$(document).ready(function(){$("[data-trigger=chart]").length>0&&($("[data-trigger=chart]").each(function(){charts($(this),$(this).data("url"))}),$("input[name=customreport]").on("apply.daterangepicker",function(t,a){void 0!==window.clickchart&&window.clickchart.destroy(),charts($("[data-trigger=chart"),$("[data-trigger=chart").data("url")+"?from="+a.startDate.format("MM/DD/YYYY")+"&to="+a.endDate.format("MM/DD/YYYY")),$(this).val(a.startDate.format("MM/DD/YYYY")+" - "+a.endDate.format("MM/DD/YYYY"))})),$("[data-trigger=dynamic-map]").length>0&&(maps($("[data-trigger=dynamic-map]"),$("[data-trigger=dynamic-map]").data("url")),$("input[name=customreport]").on("apply.daterangepicker",function(t,a){window.map.reset(),maps($("[data-trigger=dynamic-map]"),$("[data-trigger=dynamic-map]").data("url")+"?from="+a.startDate.format("MM/DD/YYYY")+"&to="+a.endDate.format("MM/DD/YYYY")),$(this).val(a.startDate.format("MM/DD/YYYY")+" - "+a.endDate.format("MM/DD/YYYY"))})),$("[data-trigger=dynamic-pie]").length>0&&($("[data-trigger=dynamic-pie]").each(function(){piechart($(this),$(this).data("url"))}),$("input[name=customreport]").on("apply.daterangepicker",function(t,a){void 0!==window.datachart&&window.datachart.destroy(),piechart($("[data-trigger=dynamic-pie]"),$("[data-trigger=dynamic-pie]").data("url")+"?from="+a.startDate.format("MM/DD/YYYY")+"&to="+a.endDate.format("MM/DD/YYYY")),$(this).val(a.startDate.format("MM/DD/YYYY")+" - "+a.endDate.format("MM/DD/YYYY"))}))});